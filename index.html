<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script
      language="javascript"
      type="text/javascript"
      src="library/p5.js"
    ></script>
    <script
      language="javascript"
      type="text/javascript"
      src="library/p5.dom.js"
    ></script>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <title>soccer mini game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <div id="container">
      <span id="score">0</span>
      <span id="emot">👌</span>
    </div>
    <script type="text/javascript">
      let ball;
      let img;
      let counter = 0;
      let container = document
        .getElementById("container")
        .getBoundingClientRect();
      let score = document.getElementById("score");
      let emot = document.getElementById("emot");
      let emots = ["👌", "💪", "👍", "😜", "🤞", "🤣", "😝", "😁"];
      let started = false;
      const W = container.width;
      const H = container.height;
      let record = 0;

      function preload() {
        img = loadImage("./img/ball.png");
      }

      function setup() {
        var cnv = createCanvas(W, H);
        cnv.style("display", "flex");
        // cnv.style("background", "#fff");
        cnv.style("position", "absolute");
        cnv.style("left", "50%");
        cnv.style("top", "50%");
        cnv.style("transform", "translate(-50%, -50%)");
        angleMode(DEGREES);
        ball = new Ball();
      }

      function draw() {
        // background(255);
        clear();
        ball.display();
        if (started) {
          ball.move();
        }
      }

      function mousePressed() {
        ball.kick();
        started = true;
      }

      function updateScore(myScore) {
        score.innerHTML = "";
        score.style.transition = ".2s";
        score.style.fontSize = "55px";
        score.style.color = "rgba(0,0,0,0.0)";
        setTimeout(() => {
          score.style.fontSize = "100px";
          score.style.color = "rgba(0,0,0,0.5)";
          score.innerHTML = myScore;
        }, 200);
      }

      function gameOver() {
        started = false;
        emot.innerHTML = "";
        if (counter > record) {
          record = counter;
        }
        counter = 0;
        score.innerHTML = record;
        score.style.transition = ".2s";
        score.style.fontSize = "200px";
        score.style.color = "#30AFFF";
        setTimeout(() => {
          ball.resetBall();
          updateScore(counter);
        }, 1000);
      }

      function emotUpdate(x, y) {
        emot.innerHTML = emots[Math.floor(random(emots.length))];
        emot.style.transform = "translate(-50%, -100%)";
        emot.style.fontSize = "0px";
        emot.style.left = x + "px";
        emot.style.top = y + "px";
        setTimeout(() => {
          emot.style.fontSize = "24px";
          emot.style.transition = "0.4s";
          emot.style.transform = "translate(-50%, -340px)";
        }, 10);
        emot.style.transition = "0s";
      }

      function Ball() {
        this.x = W / 2;
        this.y = H - 80;
        this.loc = createVector(this.x, this.y);
        this.radius = 95;
        this.vel = createVector(0, 1);
        this.gravity = createVector(0, 1.3);
        this.rotation = 0;
        this.angle = 0;
        this.bounceVal = 28;

        this.display = function() {
          push();
          translate(this.loc.x, this.loc.y);
          rotate(this.angle);
          this.angle += this.rotation;
          imageMode(CENTER);
          image(
            img,
            0,
            0,
            (img.height = this.radius),
            (img.width = this.radius)
          );
          pop();
        };

        this.move = function() {
          this.vel.add(this.gravity);
          this.loc.add(this.vel);
          if (this.loc.y - 200 > H) {
            gameOver();
          } else if (
            this.loc.x + this.radius / 2 > W ||
            this.loc.x - this.radius / 2 < 0
          ) {
            this.bounceX();
          }
        };

        this.bounceY = function() {
          this.vel.y = -this.bounceVal;
        };

        this.bounceX = function() {
          this.vel.x = -this.vel.x;
          this.rotation = -(this.rotation / 1.3);
        };

        this.bounceKick = function() {
          let dX = dist(mouseX, this.loc.y, this.loc.x, this.loc.y) / 2;
          let dY = dist(mouseY, this.loc.x, this.loc.y, this.loc.x) / 2;
          if (this.loc.x <= mouseX) {
            this.bounceY();
            this.vel.x -= dX;
            this.rotation -= dX;
            if (this.vel.x < -8) {
              this.vel.x = -8;
            }
          } else if (this.loc.x > mouseX) {
            this.bounceY();
            this.vel.x += dX;
            this.rotation += dX;
            if (this.vel.x > 8) {
              this.vel.x = 8;
            }
          }
        };

        this.kick = function() {
          let d = dist(mouseX, mouseY, this.loc.x, this.loc.y);
          if (d < this.radius / 2 + 5) {
            this.bounceKick();
            counter++;
            updateScore(counter);
            emotUpdate(this.loc.x, this.loc.y);
          }
        };

        this.resetBall = function() {
          this.loc = createVector(this.x, this.y);
          this.vel = createVector(0, 1);
          this.rotation = 0;
        };
      }
    </script>
  </body>
</html>
